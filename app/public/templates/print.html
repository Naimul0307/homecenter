<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/print.css">
    <link rel="stylesheet" href="../css/print_recipet.css">
    <link rel="shortcut icon" href="../background/favicon.ico" type="image/x-icon">
    <title>HomeCentre - Print</title>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo"></div>
        </div>

        <div class="print-body">
            <p class="message">HER contributions, counted.</p>
            <p class="message">Because SHE is the heart of every home.</p>
            <button class="confirm-button" id="review-confirm-btn">Tap to Print</button>
        </div>
    </div>

    <script src="../js/html2canvas.min.js"></script>
    <script src="../js/jspdf.umd.min.js"></script>    
    <script>
        // document.getElementById("review-confirm-btn").addEventListener("click", function () {
        //     generateReceiptPDF();
        // });

        // function generateReceiptPDF() {
        //     const { jsPDF } = window.jspdf;

        //     let receiptContainer = document.createElement("div");
        //     receiptContainer.style.position = "absolute";
        //     receiptContainer.style.left = "-9999px"; // Hides the receipt off-screen
        //     receiptContainer.innerHTML = `
        //     <div class="receipt-container" style="width: 72.1mm; padding: 10px; background-color: white; color: black;">
        //         <div class="receipt-header" style="text-align: center; margin-bottom: 10px;">
        //             <div class="logo" style="width: 100%; height: 200px; background-image: url('../background/pdflogo.png'); background-size: contain; background-repeat: no-repeat; background-position: center; filter: grayscale(100%);"></div>
        //             <hr style="border-top: 2px solid black; margin-bottom: 10px;">
        //         </div>

        //         <hr style="border-top: 2px dashed black; margin-top: 10px; margin-bottom: 10px;">

        //         <div class="receipt-body" style="margin-top: 10px; margin-bottom: 10px;">
        //             <p class="greeting" style="font-size: 18px; font-weight: bold; text-align: left; margin-bottom: 10px;"></p>
        //             <hr style="border-top: 2px dashed black; margin-top: 10px; margin-bottom: 10px;">
        //             <p class="thank-you" style="font-size: 16px; font-weight: bold; text-align: left; margin-bottom: 10px;">Thank you for</p>
        //             <ul class="items-list" style="list-style: none; padding: 0; margin-bottom: 10px;"></ul>
        //             <hr style="border-top: 2px dashed black; margin-top: 10px; margin-bottom: 10px;">
        //             <p class="total" style="font-size: 20px; font-weight: bold; text-align: left; margin-bottom: 10px;">Total: <span class="price">PRICELESS</span></p>
        //             <hr style="border-top: 2px dashed black; margin-top: 10px; margin-bottom: 10px;">
        //             <p class="tribute" style="font-size: 14px; font-weight: bold; text-align: left; margin-bottom: 5px;">This isn’t just a receipt. It’s a tribute.</p>
        //             <p class="tribute-text" style="font-size: 14px; font-weight: bold; text-align: left;">To the love, the sacrifices, the strength that hold homes together.</p>
        //         </div>

        //         <div class="footer" style="width: 100%; height: 80px; background-image: url('../background/pdfooter.png'); background-size: cover; background-position: center; filter: grayscale(100%); margin-top: 10px;"></div>
        //     </div>
        //     `;

        //     // Load user data from localStorage
        //     const storedData = localStorage.getItem("allUserContributions");
        //     let userName = "Dear User";
        //     let contributions = [];

        //     if (storedData) {
        //         try {
        //             const parsedData = JSON.parse(storedData);
        //             if (parsedData.length > 0) {
        //                 const lastUser = parsedData[parsedData.length - 1];
        //                 userName = lastUser.name || "Dear User";
        //                 contributions = lastUser.contributions || [];
        //             }
        //         } catch (e) {
        //             console.error("Error parsing user data:", e);
        //         }
        //     }

        //     // Update content dynamically
        //     receiptContainer.querySelector(".greeting").textContent = `Dear ${userName}`;
        //     let itemsList = receiptContainer.querySelector(".items-list");
        //     itemsList.innerHTML = "";

        //     if (contributions.length > 0) {
        //         contributions.forEach(item => {
        //             let li = document.createElement("li");
        //             li.textContent = item;
        //             li.style.fontSize = "14px";
        //             li.style.fontWeight = "bold";
        //             li.style.marginBottom = "10px";
        //             itemsList.appendChild(li);
        //         });
        //     } else {
        //         let li = document.createElement("li");
        //         li.textContent = "No contributions selected.";
        //         li.style.textAlign = "center";
        //         itemsList.appendChild(li);
        //     }

        //     document.body.appendChild(receiptContainer); // Append off-screen

        //     // Convert receiptContainer to canvas using html2canvas
        //     html2canvas(receiptContainer, {
        //         scale: 1,
        //         backgroundColor: "#FFFFFF"
        //     }).then(canvas => {
        //         let imgData = canvas.toDataURL("image/png");
        //         let pdf = new jsPDF({
        //             orientation: "portrait",
        //             unit: "mm",
        //             format: [80, 297]
        //         });

        //         pdf.addImage(imgData, "PNG", 0, 0, 80, (canvas.height * 80) / canvas.width);
        //         document.body.removeChild(receiptContainer); // Remove from the DOM

        //         // Open the print dialog after generating the PDF
        //         const printWindow = window.open(pdf.output('bloburl'), '_blank');
        //         printWindow.print();

        //         // Redirect after 5 seconds
        //         setTimeout(function () {
        //             window.location.href = "index.html"; // Redirect to index.html
        //         }, 5000); // 5 seconds
        //     });
        // }
document.getElementById("review-confirm-btn").addEventListener("click", function () {
    generateReceiptPDF();
});

function generateReceiptPDF() {
    const { jsPDF } = window.jspdf;

    let receiptContainer = document.createElement("div");
    receiptContainer.style.position = "absolute";
    receiptContainer.style.left = "-9999px"; // Hides the receipt off-screen
    receiptContainer.innerHTML = `
    <div class="receipt-container" style="width: 72.1mm; padding: 10px; background-color: white; color: black;">
        <div class="receipt-header" style="text-align: center; margin-bottom: 10px;">
            <div class="logo" style="width: 90%; height: 150px; background-image: url('../background/pdflogo.png'); background-size: contain; background-repeat: no-repeat; background-position: center; filter: grayscale(100%);"></div>
            <hr style="border-top: 2px solid black; margin-bottom: 10px;">
        </div>

        <hr style="border-top: 2px dashed black; margin-top: 10px; margin-bottom: 10px;">

        <div class="receipt-body" style="margin-top: 10px; margin-bottom: 10px;">
            <p class="greeting" style="font-size: 18px; font-weight: bold; text-align: left; margin-bottom: 10px;"></p>
            <hr style="border-top: 2px dashed black; margin-top: 10px; margin-bottom: 10px;">
            <p class="thank-you" style="font-size: 16px; font-weight: bold; text-align: left; margin-bottom: 10px;">Thank you for</p>
            <ul class="items-list" style="list-style: none; padding: 0; margin-bottom: 10px;"></ul>
            <hr style="border-top: 2px dashed black; margin-top: 10px; margin-bottom: 10px;">
            <p class="total" style="font-size: 20px; font-weight: bold; text-align: left; margin-bottom: 10px;">Total: <span class="price">PRICELESS</span></p>
            <hr style="border-top: 2px dashed black; margin-top: 10px; margin-bottom: 10px;">
            <p class="tribute" style="font-size: 14px; font-weight: bold; text-align: left; margin-bottom: 5px;">This isn’t just a receipt. It’s a tribute.</p>
            <p class="tribute-text" style="font-size: 14px; font-weight: bold; text-align: left;">To the love, the sacrifices, the strength that hold homes together.</p>
        </div>

        <div class="footer" style="width: 100%; height: 80px; background-image: url('../background/pdfooter.png'); background-size: cover; background-position: center; filter: grayscale(100%); margin-top: 10px;"></div>
    </div>
    `;

    // Load user data from localStorage
    const storedData = localStorage.getItem("allUserContributions");
    let userName = "Dear User";
    let contributions = [];

    if (storedData) {
        try {
            const parsedData = JSON.parse(storedData);
            if (parsedData.length > 0) {
                const lastUser = parsedData[parsedData.length - 1];
                userName = lastUser.name || "Dear User";
                contributions = lastUser.contributions || [];
            }
        } catch (e) {
            console.error("Error parsing user data:", e);
        }
    }

    // Update content dynamically
    receiptContainer.querySelector(".greeting").textContent = `Dear ${userName}`;
    let itemsList = receiptContainer.querySelector(".items-list");
    itemsList.innerHTML = "";

    if (contributions.length > 0) {
        contributions.forEach(item => {
            let li = document.createElement("li");
            li.textContent = item;
            li.style.fontSize = "14px";
            li.style.fontWeight = "bold";
            li.style.marginBottom = "10px";
            itemsList.appendChild(li);
        });
    } else {
        let li = document.createElement("li");
        li.textContent = "No contributions selected.";
        li.style.textAlign = "center";
        itemsList.appendChild(li);
    }

    document.body.appendChild(receiptContainer); // Append off-screen

    // Convert receiptContainer to canvas using html2canvas
    html2canvas(receiptContainer, {
        scale: 1,
        backgroundColor: "#FFFFFF"
    }).then(canvas => {
        let imgData = canvas.toDataURL("image/png");
        let pdf = new jsPDF({
            orientation: "portrait",
            unit: "mm",
            format: [80, 297]
        });

        pdf.addImage(imgData, "PNG", 0, 0, 80, (canvas.height * 80) / canvas.width);
        document.body.removeChild(receiptContainer); // Remove from the DOM

        // Automatically print the PDF without showing a print window
        pdf.autoPrint();
        let pdfBlob = pdf.output("blob");

        let iframe = document.createElement("iframe");
        iframe.style.position = "absolute";
        iframe.style.width = "1px";
        iframe.style.height = "1px";
        iframe.style.left = "-9999px";
        document.body.appendChild(iframe);

        let blobURL = URL.createObjectURL(pdfBlob);
        iframe.src = blobURL;
        iframe.onload = function () {
            iframe.contentWindow.print();
            setTimeout(() => {
                document.body.removeChild(iframe);
                URL.revokeObjectURL(blobURL);
            }, 5000);
        };
    });
}
    </script>
</body>
</html>