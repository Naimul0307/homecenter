<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/print.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
    <title>HomeCentre - Print</title>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo"></div>
        </div>

        <div class="print-body">
            <p class="message">HER contributions, counted.</p>
            <p class="message">Because SHE is the heart of every home.</p>
            <button class="confirm-button" id="review-confirm-btn">Tap to Print</button>
        </div>
    </div>

    <script>
document.getElementById("review-confirm-btn").addEventListener("click", function () {
    generateReceiptPDF();
});

function generateReceiptPDF() {
    // Create a hidden div to hold the receipt
    let receiptContainer = document.createElement("div");
    receiptContainer.innerHTML = `
        <div class="receipt-container" style="width: 300px; padding: 15px; border: 2px dashed #919191; border-radius: 10px; background-color: #f6f6f6;">
            <div class="receipt-header" style="display: flex; justify-content: center; align-items: center; flex-direction: column;">
                <div class="logo" style="width: 100%; height: 200px; background-image: url('../background/logo.png'); background-size: contain; background-repeat: no-repeat; background-position: center; margin-top: 5px;"></div>
                <hr style="border: none; border-top: 2px solid #111011; width: 100%; margin: 10px 0;">
            </div>
           <hr style="border: none; border-top: 2px dashed #111011; width: 100%; margin: 10px 0;">
            <div class="receipt-body">
                <p class="greeting" style="font-size: 18px; font-weight: bold; color: #333; text-align: left; margin: 20px 0;"></p>
                <hr style="border: none; border-top: 2px dashed #111011; width: 100%; margin: 10px 0;">
                <p class="thank-you" style="font-size: 16px; color: #555; text-align: left; margin: 20px 0;">Thank you for</p>
                <ul class="items-list" style="list-style: none; padding: 0;  margin: 20px 0;"></ul>
                <hr style="border: none; border-top: 2px dashed #111011; width: 100%; margin: 10px 0;">
                <p class="total" style="font-size: 20px; font-weight: bold; color: #333; text-align: left; margin: 20px 0;">Total: <span class="price" style="color: #131212;">PRICELESS</span></p>
                <hr style="border: none; border-top: 2px dashed #111011; width: 100%; margin: 10px 0;">
                <p class="tribute" style="font-size: 14px; color: #333; text-align: left; margin: 20px 0;">This isn’t just a receipt. It’s a tribute.</p>
                <p class="tribute-text" style="font-size: 14px; color: #111011; text-align: left; margin: 20px 0;">To the love, the sacrifices, the strength that hold homes together.</p>
            </div>
            <div class="footer" style="margin-top: 10px; text-align: left; background-image: url('../background/FOOTER.png'); background-size: cover; background-position: center; height: 100px; width: 100%;"></div>
        </div>
    `;

    // Load user data from localStorage
    const storedData = localStorage.getItem("allUserContributions");
    let userName = "Dear User";
    let contributions = [];

    if (storedData) {
        try {
            const parsedData = JSON.parse(storedData);
            if (parsedData.length > 0) {
                const lastUser = parsedData[parsedData.length - 1];
                userName = lastUser.name || "Dear User";
                contributions = lastUser.contributions || [];
            }
        } catch (e) {
            console.error("Error parsing user data:", e);
        }
    }

    // Update content
    receiptContainer.querySelector(".greeting").textContent = `Dear ${userName}`;
    let itemsList = receiptContainer.querySelector(".items-list");
    itemsList.innerHTML = "";

    if (contributions.length > 0) {
        contributions.forEach(item => {
            let li = document.createElement("li");
            li.textContent = item;
            li.style.fontSize = "14px";
            li.style.color = "#555";
            li.style.marginBottom = "10px";
            li.style.lineHeight = "1.5";
            li.style.textAlign = "left";
            itemsList.appendChild(li);
        });
    } else {
        let li = document.createElement("li");
        li.textContent = "No contributions selected.";
        li.style.textAlign = "center";
        itemsList.appendChild(li);
    }

    document.body.appendChild(receiptContainer); // Temporarily add to the page

    // Convert to PDF and print
    html2canvas(receiptContainer, { scale: 2 }).then(canvas => {
        let imgData = canvas.toDataURL("image/png");
        let pdf = new jsPDF("p", "mm", "a4");
        let imgWidth = 190;
        let imgHeight = (canvas.height * imgWidth) / canvas.width;
        pdf.addImage(imgData, "PNG", 10, 10, imgWidth, imgHeight);
        
        document.body.removeChild(receiptContainer); // Remove from the page
        
        pdf.save("receipt.pdf"); // Save the PDF
        window.print(); // Trigger print
    });
}

    </script>
</body>
</html>
